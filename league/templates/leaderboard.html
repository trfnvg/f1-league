{% extends "base.html" %}
{% load league_extras %}

{% block title %}Таблица сезона - F1 Predictions 2026{% endblock %}

{% block content %}
<section class="glass-panel p-3 p-md-4 mb-4" style="animation: card-enter 280ms ease-out both;">
  <div class="d-flex flex-wrap align-items-end justify-content-between gap-3">
    <div>
      <h1 class="section-title">Таблица сезона</h1>
      <p class="section-subtitle">Общий рейтинг игроков по сумме очков за все этапы.</p>
    </div>
    <div class="deadline-chip">
      <span>Игроков: {{ rows|length }}</span>
      <span style="opacity:.45;">|</span>
      <span>Этапов: {{ events|length }}</span>
    </div>
  </div>
</section>

<section class="table-shell" style="animation: card-enter 360ms ease-out both;">
  <div class="table-responsive" style="max-height: 72vh;">
    <table class="table table-sm align-middle leaderboard-table">
      <thead>
        <tr>
          <th class="sticky-col col-rank">#</th>
          <th class="sticky-col-2 col-player">Игрок</th>
          <th class="col-total text-center">Итого</th>
          {% for e in events %}
            <th class="text-center">R{{ e.round_number }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for r in rows %}
          <tr class="{% if r.is_leader %}is-leader{% endif %}">
            <td class="sticky-col col-rank">{{ r.rank }}</td>
            <td class="sticky-col-2 col-player fw-semibold">{{ r.user.username }}</td>
            <td class="col-total text-center"><span class="total-chip">{{ r.total }}</span></td>
            {% for e in events %}
              <td class="text-center">
                {% score_for scores_map r.user.id e.id as s %}
                {% if s %}
                  <span class="fw-semibold">{{ s.points }}</span>
                {% else %}
                  <span class="text-muted">-</span>
                {% endif %}
              </td>
            {% endfor %}
          </tr>
        {% empty %}
          <tr>
            <td colspan="999" class="text-muted">Пока нет игроков.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>
{% endblock %}
